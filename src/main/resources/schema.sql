DROP TABLE IF EXISTS MPA, FILM, GENRE, FILM_GENRE, "USER", FRIENDSHIP, FILM_LIKE CASCADE;
CREATE TABLE IF NOT EXISTS MPA (
	MPA_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(128)
);


CREATE TABLE IF NOT EXISTS FILM (
	FILM_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(128) NOT NULL,
	RELEASE_DATE DATE,
	DESCRIPTION CHARACTER VARYING(300),
	DURATION INTEGER,
	MPA_ID BIGINT REFERENCES MPA (MPA_ID)
);

CREATE TABLE IF NOT EXISTS GENRE (
	GENRE_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(128)
);


CREATE TABLE IF NOT EXISTS FILM_GENRE (
	FILM_ID BIGINT REFERENCES FILM (FILM_ID),
	GENRE_ID BIGINT REFERENCES GENRE (GENRE_ID),
	PRIMARY KEY (FILM_ID, GENRE_ID)
);

CREATE TABLE IF NOT EXISTS "USER" (
	USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	EMAIL CHARACTER VARYING(320) NOT NULL,
	LOGIN CHARACTER VARYING(64) NOT NULL,
	NAME CHARACTER VARYING(128),
	BIRTHDAY DATE
);

CREATE TABLE IF NOT EXISTS FRIENDSHIP (
	SENDER_ID BIGINT  REFERENCES "USER" (USER_ID),
	RECIPIENT_ID BIGINT  REFERENCES "USER" (USER_ID),
	PRIMARY KEY (SENDER_ID, RECIPIENT_ID)
);

CREATE TABLE IF NOT EXISTS FILM_LIKE (
	USER_ID BIGINT  REFERENCES "USER" (USER_ID),
	FILM_ID BIGINT REFERENCES FILM (FILM_ID),
	PRIMARY KEY (USER_ID, FILM_ID)
);